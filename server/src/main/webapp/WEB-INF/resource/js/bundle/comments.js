webpackJsonp([1],{0:function(e,t,n){"use strict";var a=n(1),s=n(261),r=n(265).Page,i=new a({html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkify:!1,typographer:!1,highlight:function(){return""}});$(document).ready(function(){var e=sessionStorage.getItem("animeId"),t=sessionStorage.getItem("desc");console.debug(i.render(t)),$("#desc").replaceWith(i.render(t)),ReactDOM.render(React.createElement(o,{animeId:e}),document.getElementById("comments"))});var o=React.createClass({displayName:"Comments",getInitialState:function(){return{comments:new Array,isLogin:!1,userId:null}},componentDidMount:function(){var e=this;this.list(),Ajax.get("/api/islogin",null,{success:function(t){e.setState({isLogin:t.isLogin,userId:t.userId})}})},list:function(){var e=this,t="/anime/comments/"+this.props.animeId;Ajax.get(t,null,{success:function(t){e.setState({comments:t})}})},handleComment:function(e){var t=this,n=new Object;n.animeId=this.props.animeId,n.comment=e,Ajax.post("/anime/comments",n,{success:function(e){t.list()}})},handleDelete:function(e){var t=this;Ajax.delete("/anime/comments",e,{success:function(e){t.list()}})},render:function(){var e=this.state.isLogin;return React.createElement("div",null,React.createElement(c,{isLogin:e,onComment:this.handleComment}),React.createElement(l,{comments:this.state.comments,userId:this.state.userId,onDelete:this.handleDelete}))}}),l=React.createClass({displayName:"CommentList",getInitialState:function(){return{current:1,size:5}},componentWillReceiveProps:function(e){var t=parseInt(e.comments.length/(this.state.size+1)+1);this.state.current>t&&this.setState({current:t})},handlePage:function(e){this.setState({current:e})},renderList:function(e){var t=this,n=this;return e.map(function(e,a){var r=(n.state.current-1)*t.state.size,i=n.state.current*t.state.size-1;return a<r||a>i?null:React.createElement("div",{className:"event"},React.createElement("div",{className:"label"},React.createElement("img",{src:"https://semantic-ui.com/images/avatar2/small/elyse.png"})),React.createElement("div",{className:"content"},React.createElement("div",{className:"summary"},React.createElement("a",{className:"user"},e.username),React.createElement("div",{className:"date"})),React.createElement("div",{className:"extra text"},e.comment),React.createElement("div",{className:"meta"},React.createElement("h",null,s(parseInt(e.date)).format("YYYY-MM-DD hh:mm")),e.userId==n.props.userId&&React.createElement("a",{onClick:function(){return n.props.onDelete(e)}},"删除"))))})},render:function(){if(0==this.props.comments.length)return null;var e=this.renderList(this.props.comments);return React.createElement("div",null,React.createElement(r,{current:this.state.current,total:this.props.comments.length/(this.state.size+1)+1,onPage:this.handlePage}),React.createElement("div",{className:"ui feed"},e))}}),c=React.createClass({displayName:"CommentInput",getDefaultProps:function(){return{isLogin:!0}},handleClick:function(){this.props.onComment($(this.refs.input).val()),$(this.refs.input).val("")},renderUnLogin:function(){return React.createElement("div",{className:"ui form"},React.createElement("div",{className:"field"},React.createElement("label",null,"评论",React.createElement("a",{href:CONTEXT+"/user/login"},"(请先登录)"))))},render:function(){var e=this.props.isLogin;return e?React.createElement("div",{className:"ui form"},React.createElement("div",{className:"field"},React.createElement("label",null,"评论"),React.createElement("textarea",{rows:"2",ref:"input"})),React.createElement("button",{className:"ui primary button",onClick:this.handleClick},"提交")):this.renderUnLogin()}})},265:function(e,t,n){"use strict";function a(e,t){var n=new Map,a=new Map;e.map(function(e){var s=e[t];n.set(s,e),a.set(s,h(e))});var s={sync:function(e){var t=a.get(e);n.set(e,h(t))},get:function(e){return n.get(e)},set:function(e,t){n.set(e,t),a.set(e,h(t))},setCurrent:function(e,t){n.set(e,t)},array:function(){return n.values()},remove:function(e){console.debug(e),n.delete(e),a.delete(e)},values:function(e){return n.values()},map:function(){return n}};return s}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=n(261),i="origin",o="modify",l="new",c="newmodify",u=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)}).toUpperCase()},p={setPropoerty:function(e,t,n){if(null==e)throw"obj is null";var a=e,s=t.split(".");console.debug("setPropoerty:",s);for(var r=0;r<s.length;r++){var i=s[r];r==s.length-1?a[i]=n:(null==a[i]&&(a[i]=new Object),a=a[i])}console.debug("setPropoerty:",e)},getProperty:function(e,t){if(null==e)throw"obj is null";for(var n=e,a=t.split("."),s=0;s<a.length;s++){var r=a[s];if(s!=a.length-1&&null==n[r])throw r+"is null";n=n[r]}return n}},h=function e(t){var n,a=t.constructor===Array?[]:{};if("object"===("undefined"==typeof t?"undefined":s(t))){if(window.JSON)n=JSON.stringify(t),a=JSON.parse(n);else for(var r in t)a[r]="object"===s(t[r])?e(t[r]):t[r];return a}},d=React.createClass({displayName:"Table",getDefaultProps:function(){return{titles:new Array,datas:new Array,onSave:function(e){return!0},modify:function(e){return!0},delete:function(e){return!0},onRenderButtons:function(e){return null},page:{current:1,total:1},displayEditButtons:!0}},getInitialState:function(){this.init();var e=this.props.datas,t=null;return e.length>0&&(t=this.initDoubleData(e)),{page:this.props.page,doubleDatas:t,hasNewRow:!1}},init:function(){this.autoKey=!this.props.hasOwnProperty("primaryKey"),this.columns=this.getColumns()},getColumns:function(){var e=new Array;return React.Children.map(this.props.children,function(t){"Column"==t.type.displayName&&e.push(t)}),e},initDoubleData:function(e){var t=this,n=e.map(function(e){return e._status=i,e._key=t.getKey(e),e});return a(n,"_key")},componentDidMount:function(){var e=this,t=function(){document.addEventListener("keydown",function(t){t.ctrlKey&&"KeyI"==t.code&&e.insertRow()})};t();var n=function(){if(null==e.state.doubleDatas){if(e.props.hasOwnProperty("onList"))return void e.handleList();e.props.hasOwnProperty("onPage")&&e.handlePage("1")}};n()},componentWillReceiveProps:function(e){this.setState({doubleDatas:this.initDoubleData(e.datas)})},getKey:function(e){return this.autoKey||e._status==l?u():e[this.props.primaryKey]},handleDelete:function(e,t){if(confirm("确认删除？")){var n=!0;if(n=this.props.delete(e),!n)return void alert("删除失败");this.state.doubleDatas.remove(e._key),this.setState({doubleDatas:this.state.doubleDatas})}},handleModify:function(e,t){var n=this.state.doubleDatas.get(e._key);n._status=o,this.state.doubleDatas.setCurrent(e._key,n),this.setState({doubleDatas:this.state.doubleDatas})},handleSave:function(e,t){var n=!0;return(n=e._status==l||e._status==c?this.props.onSave(e):this.props.modify(e))?(e._status!=l&&e._status!=c||(e._key=this.getKey(e),this.setState({hasNewRow:!1})),e._status=i,this.state.doubleDatas.set(e._key,e),void this.setState({doubleDatas:this.state.doubleDatas})):void alert("保存失败")},handleCancel:function(e,t){e._status!=l&&e._status!=c||this.setState({hasNewRow:!1}),e._status!=l&&e._status!=c&&(this.state.doubleDatas.sync(e._key),this.setState({doubleDatas:this.state.doubleDatas}))},handleList:function(){var e=this.props.onList(),t=this.initDoubleData(e);this.setState({doubleDatas:t})},handlePage:function(e){var t=this.props.onPage(e),n=t.page,a=this.initDoubleData(t.data);this.setState({doubleDatas:a,page:n})},insertRow:function(){1!=this.state.hasNewRow&&this.setState({hasNewRow:!0})},renderColumnTitles:function(){var e=this.props.titles;return e.map(function(e){return React.createElement("th",{className:"single line"},e)})},renderInsertButton:function(){return this.props.displayEditButtons?React.createElement("button",{className:"ui teal icon button",disabled:this.state.hasNewRow?"disabled":"",onClick:this.insertRow},React.createElement("i",{className:"ui plus icon"})):null},renderRow:function(e){return React.createElement(m,{data:e,key:e._key,status:e._status,onDeleteClick:this.handleDelete,onModifyClick:this.handleModify,onSaveClick:this.handleSave,onCancelClick:this.handleCancel,onRenderButtons:this.props.onRenderButtons,displayEditButtons:this.props.displayEditButtons,rule:this.props.rule,columns:this.columns})},renderRows:function(){var e=this;if(null==this.state.doubleDatas)return null;var t=new Array;return this.state.doubleDatas.map().forEach(function(n,a,s){t.push(e.renderRow(n))}),t},renderNewRow:function(){if(!this.state.hasNewRow)return null;var e=new Object;return e._status=l,e._key=this.getKey(e),this.renderRow(e)},render:function(){var e=this.renderColumnTitles(),t=this.renderInsertButton(),n=this.renderRows(),a=this.renderNewRow();return console.debug("Table render"),React.createElement("div",{ref:"container"},React.createElement("h3",null,this.props.title),React.createElement(C,{onPage:this.handlePage,current:this.state.page.current,total:this.state.page.total}),React.createElement("table",{className:"ui celled compact table"},React.createElement("thead",null,React.createElement("tr",{className:"form"},e,React.createElement("th",null,t))),React.createElement("tbody",null,a,n)))}}),m=React.createClass({displayName:"Row",getInitialState:function(){return{data:this.props.data,status:this.props.status}},componentWillReceiveProps:function(e){this.setState({data:e.data,status:e.status})},shouldComponentUpdate:function(e,t){return(e.data!=this.props.data||e.status!=this.props.status)&&(console.debug("ComponentUpdate\n","nextProps:",e,"\n","this.props:",this.props),!0)},componentDidMount:function(){if(this.needValidate=!1,this.props.hasOwnProperty("rule")&&void 0!=this.props.rule){this.needValidate=!0;var e=this.props.rule;e.onInvalid=function(e){$(this).popup("exists")?$(this).popup("change content",e):$(this).popup({content:e,on:"manual",inline:!0}),$(this).popup("show")},e.onValid=function(){$(this).popup("exists")&&$(this).popup("hide")},$(this.refs.tr).form(this.props.rule)}},deleteClick:function(){this.props.onDeleteClick(this.state.data,this.props.key)},modifyClick:function(){this.props.onModifyClick(this.state.data,this.props.key)},saveClick:function(){this.isValidate()&&this.props.onSaveClick(this.state.data,this.props.key)},cancelClick:function(){return $(document).popup("hide all"),this.state.status==l||this.state.status==c?void this.props.onCancelClick(this.props.data,this.props.key):void this.props.onCancelClick(this.props.data,this.props.key)},isValidate:function(){return!this.needValidate||($(this.refs.tr).form("validate form"),$(this.refs.tr).form("is valid"))},change:function(e,t){var n=e.target.name;null==t&&(t=e.target.value);var a=this.state.status;a==l&&(a=c),this.setState(function(e,s){var r=e.data;return p.setPropoerty(r,n,t),console.debug("change data",r),{data:r,status:a}})},renderRow:function(){var e=this.state.status,t=this.state.data,n=this;return console.debug("Row renderRow:",t),console.debug(e),this.props.columns.map(function(a){e==l&&p.setPropoerty(t,a.props.name,a.props.defaultValue);var s=p.getProperty(t,a.props.name),r={value:s,status:e,readOnly:e!=o&&e!=l&&e!=c,onChange:n.change},i=React.cloneElement(a,r);return React.createElement("td",{className:"collapsing"},React.createElement("div",{className:"field"},i))})},renderButtons:function(){var e=this.state.status,t=new Array;return this.props.displayEditButtons&&(e!=o&&e!=l&&e!=c||(t.push(React.createElement("button",{className:"ui orange icon button",onClick:this.saveClick},React.createElement("i",{className:e==l||e==c?"add circle icon":"save icon"}))),t.push(React.createElement("button",{className:"ui icon button",onClick:this.cancelClick},React.createElement("i",{className:"undo icon"})))),e!=o&&e!=l&&e!=c&&(t.push(React.createElement("button",{className:"ui blue icon button",onClick:this.modifyClick},React.createElement("i",{className:"edit icon"}))),t.push(React.createElement("button",{className:"ui red icon button",onClick:this.deleteClick},React.createElement("i",{className:"trash icon"}))))),t.push(this.props.onRenderButtons(this.state.data)),React.createElement("td",null,t)},render:function(){return console.debug("render row:",this.state.data),React.createElement("tr",{ref:"tr"},this.renderRow(),this.renderButtons())}}),f=React.createClass({displayName:"Input",getDefaultProps:function(){return{border:!1}},getInitialState:function(){return{value:this.props.value}},handleChange:function(e){null!=this.props.onChange&&this.props.onChange(e),this.setState({value:e.target.value})},handleBlur:function(e){null!=this.props.onBlur&&this.props.onBlur(e),this.setState({value:e.target.value})},componentWillReceiveProps:function(e){this.state.value!=e.value&&this.setState({value:e.value})},render:function(){var e=this.props.style,t=!this.props.readOnly||this.props.border;return t||(null==e&&(e=new Object),e.border="1px solid rgba(0, 0, 0, 0.0)"),React.createElement("input",{value:this.state.value,name:this.props.name,type:this.props.type,onChange:this.handleChange,onBlur:this.handleBlur,readOnly:this.props.readOnly&&"readOnly",style:e})}}),v=React.createClass({displayName:"Select",getDefaultProps:function(){return{value:""}},getInitialState:function(){return{value:this.props.value}},handleChange:function(e){console.debug(e),console.debug(this.props.onChange),null!=this.props.onChange&&this.props.onChange(e)},componentWillReceiveProps:function(e){this.state.value!=e.value&&this.setState({value:e.value})},componentDidMount:function(){var e=this;$(e.refs.select).dropdown({onChange:function(t,n,a){var s={target:{value:t,name:e.props.name}};e.handleChange(s)}})},componentDidUpdate:function(e,t){$(this.refs.select).dropdown("set selected",this.state.value)},renderItems:function(){var e=new Array;for(var t in this.props.map){var n=React.createElement("div",{className:"item","data-value":t},this.props.map[t]);e.push(n)}return e},getStyle:function(){var e=this.props.style;return null==e&&(e=new Object),e.minWidth="8rem",e},render:function(){var e=this.getStyle();return React.createElement("div",{ref:"select",className:"ui selection dropdown search fluid "+(this.props.readOnly&&"disabled"),style:e,name:this.props.name},React.createElement("input",{type:"hidden",name:this.props.name,value:this.state.value}),React.createElement("div",{className:"default text"}),React.createElement("i",{className:"dropdown icon"}),React.createElement("div",{className:"menu"},this.renderItems()))}}),g=React.createClass({displayName:"Column",getDefaultProps:function(){return{readOnly:!0,canModify:!0,defaultValue:""}},render:function(){var e=this.props.readOnly,t=(this.props.status,this.props.value),n=this.props.width;return this.props.canModify||(e=!0),"select"==this.props.type?React.createElement(v,{value:t,name:this.props.name,map:this.props.map,style:{maxWidth:n},readOnly:e,onChange:this.props.onChange}):"datetime"==this.props.type?React.createElement(R,{value:t,readOnly:e,style:{maxWidth:n},name:this.props.name,onChange:this.props.onChange}):"textarea"==this.props.type?React.createElement(y,{value:t,readOnly:e,style:{maxWidth:n},name:this.props.name,onChange:this.props.onChange}):React.createElement("div",{className:"ui small input",style:{maxWidth:n}},React.createElement(f,{value:t,name:this.props.name,type:this.props.type,readOnly:e,onBlur:this.props.onChange}))}}),y=React.createClass({displayName:"TextArea",getInitialState:function(){return{value:this.props.value}},componentWillReceiveProps:function(e){this.setState({value:e.value})},handleClick:function(){this.props.readOnly||$(this.refs.modal).modal("show")},handleChange:function(e){this.props.onChange(e),this.setState({value:e.target.value})},renderInput:function(){return React.createElement("div",{className:"ui small icon input",style:this.props.style,onClick:this.handleClick},React.createElement(f,{value:this.state.value,name:this.props.name,readOnly:!0,border:!this.props.readOnly}),!this.props.readOnly&&React.createElement("i",{className:"edit outline icon"}))},renderModal:function(){return React.createElement("div",{className:"ui modal",ref:"modal"},React.createElement("div",{className:"content"},React.createElement("div",{className:"ui form"},React.createElement("textarea",{name:this.props.name,value:this.state.value,onChange:this.handleChange}))))},render:function(){return React.createElement("div",null,this.renderInput(),this.renderModal())}}),R=React.createClass({displayName:"Datetime",handleChange:function(e){var t=r(e.target.value).format("x");this.props.onChange(e,t)},render:function(){console.debug(this.props.value);var e=r(parseInt(this.props.value)).format("YYYY-MM-DDTHH:mm");return React.createElement("div",{className:"ui small input",style:this.props.style},React.createElement(f,{type:"datetime-local",value:e,name:this.props.name,readOnly:this.props.readOnly,onBlur:this.handleChange}))}}),C=React.createClass({displayName:"Page",getDefaultProps:function(){return{onPage:function(e){return!0},current:1,total:1}},getInitialState:function(){return{current:this.props.current,total:this.props.total}},componentWillReceiveProps:function(e){e.total!=this.state.total&&this.setState({total:e.total}),this.setState({current:e.current})},renderItems:function(){for(var e=this,t=new Array,n=function(n){n==e.state.current?t.push(React.createElement("a",{className:"active item"},n)):t.push(React.createElement("a",{className:"item",onClick:function(){e.onClick(n)}},n))},a=1;a<=this.state.total;a++)n(a);return t},onClick:function(e){e<1||e>this.state.total||this.props.onPage(e)&&this.setState({current:e})},render:function(){var e=this;return 1==this.state.current&&1==this.state.total?null:React.createElement("div",{className:"ui right floated pagination mini menu",style:{margin:"5px 0"}},React.createElement("a",{className:"icon item",onClick:function(){e.onClick(e.state.current-1)}},React.createElement("i",{className:"left chevron icon"})),this.renderItems(),React.createElement("a",{className:"icon item",onClick:function(){e.onClick(e.state.current+1)}},React.createElement("i",{className:"right chevron icon"})))}}),E=React.createClass({displayName:"DropDown",componentWillMount:function(){var e=this.props.list(),t=e.map(function(e,t){return React.createElement("option",{value:e.code},e.code+"-"+e.value)});this.setState({options:t})},componentDidMount:function(){var e=$(this.refs.select);e.dropdown();var t=e.find("option"),n=null;t.length>0&&(n=t.get(0).value),null!=n&&this.handleChange({target:{value:n}})},handleChange:function(e){console.debug(e),this.props.onChange(e)},render:function(){var e=this.state.options;return React.createElement("select",{ref:"select",className:"ui search dropdown",onChange:this.handleChange,onLoad:this.handleChange},e)}});e.exports.Table=d,e.exports.Column=g,e.exports.DropDown=E,e.exports.Select=v,e.exports.Page=C}});