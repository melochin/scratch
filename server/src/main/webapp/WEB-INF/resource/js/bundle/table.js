!function(e){var t={};function n(a){if(t[a])return t[a].exports;var s=t[a]={i:a,l:!1,exports:{}};return e[a].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(a,s,function(t){return e[t]}.bind(null,s));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=33)}({0:function(e,t){e.exports=vendors},1:function(e,t,n){e.exports=n(0)(1)},2:function(e,t,n){e.exports=n(0)(130)},3:function(e,t,n){"use strict";var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=n(1),i=(n(2),n(6)),r="new",o=function(e,t,n){if(null==e)throw"obj is null";var a=e,s=t.split(".");console.debug("setPropoerty:",s);for(var i=0;i<s.length;i++){var r=s[i];i==s.length-1?a[r]=n:(null==a[r]&&(a[r]=new Object),a=a[r])}console.debug("setPropoerty:",e)},l=function(e,t){if(null==e)throw"obj is null";for(var n=e,a=t.split("."),s=0;s<a.length;s++){var i=a[s];if(s!=a.length-1&&null==n[i])throw i+"is null";n=n[i]}return n},u=function e(t){var n,s=t.constructor===Array?[]:{};if("object"===(void 0===t?"undefined":a(t))){if(window.JSON)n=JSON.stringify(t),s=JSON.parse(n);else for(var i in t)s[i]="object"===a(t[i])?e(t[i]):t[i];return s}};var c=s.createClass({displayName:"Table",getDefaultProps:function(){return{titles:new Array,datas:new Array,onSave:function(e){return!0},onAfterSave:function(){},modify:function(e){return!0},delete:function(e){return!0},onRenderButtons:function(e){return null},page:{current:1,total:1},displayEditButtons:!0}},getInitialState:function(){this.init();var e=this.props.datas,t=null;return e.length>0&&(t=this.initDoubleData(e)),{page:this.props.page,doubleDatas:t,hasNewRow:!1}},init:function(){this.autoKey=!this.props.hasOwnProperty("primaryKey"),this.columns=this.getColumns()},getColumns:function(){var e=new Array;return s.Children.map(this.props.children,function(t){"Column"==t.type.displayName&&e.push(t)}),e},initDoubleData:function(e){var t=this;return function(e,t){var n=new Map,a=new Map;return e.map(function(e){var s=e[t];n.set(s,e),a.set(s,u(e))}),{sync:function(e){var t=a.get(e);n.set(e,u(t))},get:function(e){return n.get(e)},set:function(e,t){n.set(e,t),a.set(e,u(t))},setCurrent:function(e,t){n.set(e,t)},array:function(){return n.values()},remove:function(e){console.debug(e),n.delete(e),a.delete(e)},values:function(e){return n.values()},map:function(){return n}}}(e.map(function(e){return e._status="origin",e._key=t.getKey(e),e}),"_key")},componentDidMount:function(){var e=this;document.addEventListener("keydown",function(t){t.ctrlKey&&"KeyI"==t.code&&e.insertRow()});!function(){if(null==e.state.doubleDatas){if(e.props.hasOwnProperty("onList"))return void e.handleList();e.props.hasOwnProperty("onPage")&&e.handlePage("1")}}()},componentWillReceiveProps:function(e){this.setState({doubleDatas:this.initDoubleData(e.datas)})},componentDidUpdate:function(e,t){this.props.onAfterSave()},getKey:function(e){return this.autoKey||e._status==r?"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}).toUpperCase():e[this.props.primaryKey]},handleDelete:function(e,t){if(confirm("确认删除？")){this.props.delete(e)?(this.state.doubleDatas.remove(e._key),this.setState({doubleDatas:this.state.doubleDatas})):alert("删除失败")}},handleModify:function(e,t){var n=this.state.doubleDatas.get(e._key);n._status="modify",this.state.doubleDatas.setCurrent(e._key,n),this.setState({doubleDatas:this.state.doubleDatas})},handleSave:function(e,t){(e._status==r||"newmodify"==e._status?this.props.onSave(e):this.props.modify(e))?(e._status!=r&&"newmodify"!=e._status||(e._key=this.getKey(e),this.setState({hasNewRow:!1})),e._status="origin",this.state.doubleDatas.set(e._key,e),this.setState({doubleDatas:this.state.doubleDatas}),this.props.onAfterSave()):alert("保存失败")},handleCancel:function(e,t){e._status!=r&&"newmodify"!=e._status||this.setState({hasNewRow:!1}),e._status!=r&&"newmodify"!=e._status&&(this.state.doubleDatas.sync(e._key),this.setState({doubleDatas:this.state.doubleDatas}))},handleList:function(){var e=this.props.onList(),t=this.initDoubleData(e);this.setState({doubleDatas:t})},handlePage:function(e){var t=this.props.onPage(e),n=t.page,a=this.initDoubleData(t.data);this.setState({doubleDatas:a,page:n})},insertRow:function(){1!=this.state.hasNewRow&&this.setState({hasNewRow:!0})},renderColumnTitles:function(){return this.props.titles.map(function(e){return s.createElement("th",{className:"single line"},e)})},renderInsertButton:function(){return this.props.displayEditButtons?s.createElement("button",{className:"ui teal icon button",disabled:this.state.hasNewRow?"disabled":"",onClick:this.insertRow},s.createElement("i",{className:"ui plus icon"})):null},renderRow:function(e){return s.createElement(p,{data:e,key:e._key,status:e._status,onDeleteClick:this.handleDelete,onModifyClick:this.handleModify,onSaveClick:this.handleSave,onCancelClick:this.handleCancel,onRenderButtons:this.props.onRenderButtons,displayEditButtons:this.props.displayEditButtons,rule:this.props.rule,columns:this.columns})},renderRows:function(){var e=this;if(null==this.state.doubleDatas)return null;var t=new Array;return this.state.doubleDatas.map().forEach(function(n,a,s){t.push(e.renderRow(n))}),t},renderNewRow:function(){if(!this.state.hasNewRow)return null;var e=new Object;return e._status=r,e._key=this.getKey(e),this.renderRow(e)},render:function(){var e=this.renderColumnTitles(),t=this.renderInsertButton(),n=this.renderRows(),a=this.renderNewRow();return console.debug("Table render"),s.createElement("div",{ref:"container"},s.createElement("h3",null,this.props.title),s.createElement(v,{onPage:this.handlePage,current:this.state.page.current,total:this.state.page.total}),s.createElement("table",{className:"ui celled compact table"},s.createElement("thead",null,s.createElement("tr",{className:"form"},e,s.createElement("th",null,t))),s.createElement("tbody",null,a,n)))}}),p=s.createClass({displayName:"Row",getInitialState:function(){return{data:this.props.data,status:this.props.status}},componentWillReceiveProps:function(e){this.setState({data:e.data,status:e.status})},shouldComponentUpdate:function(e,t){return(e.data!=this.props.data||e.status!=this.props.status)&&(console.debug("ComponentUpdate\n","nextProps:",e,"\n","this.props:",this.props),!0)},componentDidMount:function(){if(this.needValidate=!1,this.props.hasOwnProperty("rule")&&void 0!=this.props.rule){this.needValidate=!0;var e=this.props.rule;e.onInvalid=function(e){$(this).popup("exists")?$(this).popup("change content",e):$(this).popup({content:e,on:"manual",inline:!0}),$(this).popup("show")},e.onValid=function(){$(this).popup("exists")&&$(this).popup("hide")},$(this.refs.tr).form(this.props.rule)}},deleteClick:function(){this.props.onDeleteClick(this.state.data,this.props.key)},modifyClick:function(){this.props.onModifyClick(this.state.data,this.props.key)},saveClick:function(){this.isValidate()&&this.props.onSaveClick(this.state.data,this.props.key)},cancelClick:function(){$(document).popup("hide all"),this.state.status!=r&&this.state.status,this.props.onCancelClick(this.props.data,this.props.key)},isValidate:function(){return!this.needValidate||($(this.refs.tr).form("validate form"),$(this.refs.tr).form("is valid"))},change:function(e,t){var n=e.target.name;null==t&&(t=e.target.value);var a=this.state.status;a==r&&(a="newmodify"),this.setState(function(e,s){var i=e.data;return o(i,n,t),console.debug("change data",i),{data:i,status:a}})},renderRow:function(){var e=this.state.status,t=this.state.data,n=this;return console.debug("Row renderRow:",t),console.debug(e),this.props.columns.map(function(a){e==r&&o(t,a.props.name,a.props.defaultValue);var i={value:l(t,a.props.name),status:e,readOnly:"modify"!=e&&e!=r&&"newmodify"!=e,onChange:n.change},u=s.cloneElement(a,i);return s.createElement("td",{className:"collapsing"},s.createElement("div",{className:"field"},u))})},renderButtons:function(){var e=this.state.status,t=new Array;return this.props.displayEditButtons&&("modify"!=e&&e!=r&&"newmodify"!=e||(t.push(s.createElement("button",{className:"ui orange icon button",onClick:this.saveClick},s.createElement("i",{className:e==r||"newmodify"==e?"add circle icon":"save icon"}))),t.push(s.createElement("button",{className:"ui icon button",onClick:this.cancelClick},s.createElement("i",{className:"undo icon"})))),"modify"!=e&&e!=r&&"newmodify"!=e&&(t.push(s.createElement("button",{className:"ui blue icon button",onClick:this.modifyClick},s.createElement("i",{className:"edit icon"}))),t.push(s.createElement("button",{className:"ui red icon button",onClick:this.deleteClick},s.createElement("i",{className:"trash icon"}))))),t.push(this.props.onRenderButtons(this.state.data)),s.createElement("td",null,t)},render:function(){return console.debug("render row:",this.state.data),s.createElement("tr",{ref:"tr"},this.renderRow(),this.renderButtons())}}),d=s.createClass({displayName:"Input",getDefaultProps:function(){return{border:!1}},getInitialState:function(){return{value:this.props.value}},handleChange:function(e){null!=this.props.onChange&&this.props.onChange(e),this.setState({value:e.target.value})},handleBlur:function(e){null!=this.props.onBlur&&this.props.onBlur(e),this.setState({value:e.target.value})},componentWillReceiveProps:function(e){this.state.value!=e.value&&this.setState({value:e.value})},render:function(){var e=this.props.style;return!this.props.readOnly||this.props.border||(null==e&&(e=new Object),e.border="1px solid rgba(0, 0, 0, 0.0)"),s.createElement("input",{value:this.state.value,name:this.props.name,type:this.props.type,onChange:this.handleChange,onBlur:this.handleBlur,readOnly:this.props.readOnly&&"readOnly",style:e})}}),h=s.createClass({displayName:"Select",getDefaultProps:function(){return{value:""}},getInitialState:function(){return{value:this.props.value}},handleChange:function(e){console.debug(e),console.debug(this.props.onChange),null!=this.props.onChange&&this.props.onChange(e)},componentWillReceiveProps:function(e){this.state.value!=e.value&&this.setState({value:e.value})},componentDidMount:function(){var e=this;$(e.refs.select).dropdown({onChange:function(t,n,a){var s={target:{value:t,name:e.props.name}};e.handleChange(s)}})},componentDidUpdate:function(e,t){$(this.refs.select).dropdown("set selected",this.state.value)},renderItems:function(){var e=new Array;for(var t in this.props.map){var n=s.createElement("div",{className:"item","data-value":t},this.props.map[t]);e.push(n)}return e},getStyle:function(){var e=this.props.style;return null==e&&(e=new Object),e.minWidth="8rem",e},render:function(){var e=this.getStyle();return s.createElement("div",{ref:"select",className:"ui selection dropdown search fluid "+(this.props.readOnly&&"disabled"),style:e,name:this.props.name},s.createElement("input",{type:"hidden",name:this.props.name,value:this.state.value}),s.createElement("div",{className:"default text"}),s.createElement("i",{className:"dropdown icon"}),s.createElement("div",{className:"menu"},this.renderItems()))}}),m=s.createClass({displayName:"Column",getDefaultProps:function(){return{readOnly:!0,canModify:!0,defaultValue:""}},render:function(){var e=this.props.readOnly,t=(this.props.status,this.props.value),n=this.props.width;return this.props.canModify||(e=!0),"select"==this.props.type?s.createElement(h,{value:t,name:this.props.name,map:this.props.map,style:{maxWidth:n},readOnly:e,onChange:this.props.onChange}):"datetime"==this.props.type?s.createElement(y,{value:t,readOnly:e,style:{maxWidth:n},name:this.props.name,onChange:this.props.onChange}):"textarea"==this.props.type?s.createElement(f,{value:t,readOnly:e,style:{maxWidth:n},name:this.props.name,onChange:this.props.onChange}):s.createElement("div",{className:"ui small input",style:{maxWidth:n}},s.createElement(d,{value:t,name:this.props.name,type:this.props.type,readOnly:e,onBlur:this.props.onChange}))}}),f=s.createClass({displayName:"TextArea",getInitialState:function(){return{value:this.props.value}},componentWillReceiveProps:function(e){this.setState({value:e.value})},handleClick:function(){this.props.readOnly||$(this.refs.modal).modal("show")},handleChange:function(e){this.props.onChange(e),this.setState({value:e.target.value})},renderInput:function(){return s.createElement("div",{className:"ui small icon input",style:this.props.style,onClick:this.handleClick},s.createElement(d,{value:this.state.value,name:this.props.name,readOnly:!0,border:!this.props.readOnly}),!this.props.readOnly&&s.createElement("i",{className:"edit outline icon"}))},renderModal:function(){return s.createElement("div",{className:"ui modal",ref:"modal"},s.createElement("div",{className:"content"},s.createElement("div",{className:"ui form"},s.createElement("textarea",{name:this.props.name,value:this.state.value,onChange:this.handleChange}))))},render:function(){return s.createElement("div",null,this.renderInput(),this.renderModal())}}),y=s.createClass({displayName:"Datetime",handleChange:function(e){var t=i(e.target.value).valueOf();this.props.onChange(e,t)},render:function(){console.debug(this.props.value);var e=i(parseInt(this.props.value)).format("YYYY-MM-DDTHH:mm");return s.createElement("div",{className:"ui small input",style:this.props.style},s.createElement(d,{type:"datetime-local",value:e,name:this.props.name,readOnly:this.props.readOnly,onBlur:this.handleChange}))}}),v=s.createClass({displayName:"Page",getDefaultProps:function(){return{onPage:function(e){return!0},current:1,total:1}},getInitialState:function(){return{current:this.props.current,total:this.props.total}},componentWillReceiveProps:function(e){e.total!=this.state.total&&this.setState({total:e.total}),this.setState({current:e.current})},renderItems:function(){for(var e=this,t=new Array,n=function(n){n==e.state.current?t.push(s.createElement("a",{className:"active item"},n)):t.push(s.createElement("a",{className:"item",onClick:function(){e.onClick(n)}},n))},a=1;a<=this.state.total;a++)n(a);return t},onClick:function(e){e<1||e>this.state.total||this.props.onPage(e)&&this.setState({current:e})},render:function(){var e=this;return 1==this.state.current&&1==this.state.total?null:s.createElement("div",{className:"ui right floated pagination mini menu",style:{margin:"5px 0"}},s.createElement("a",{className:"icon item",onClick:function(){e.onClick(e.state.current-1)}},s.createElement("i",{className:"left chevron icon"})),this.renderItems(),s.createElement("a",{className:"icon item",onClick:function(){e.onClick(e.state.current+1)}},s.createElement("i",{className:"right chevron icon"})))}}),g=s.createClass({displayName:"DropDown",componentWillMount:function(){var e=this.props.list().map(function(e,t){return s.createElement("option",{value:e.code},e.code+"-"+e.value)});this.setState({options:e})},componentDidMount:function(){var e=$(this.refs.select);e.dropdown();var t=e.find("option"),n=null;t.length>0&&(n=t.get(0).value),null!=n&&this.handleChange({target:{value:n}})},handleChange:function(e){console.debug(e),this.props.onChange(e)},render:function(){var e=this.state.options;return s.createElement("select",{ref:"select",className:"ui search dropdown",onChange:this.handleChange,onLoad:this.handleChange},e)}});e.exports.Table=c,e.exports.Column=m,e.exports.DropDown=g,e.exports.Select=h,e.exports.Page=v},33:function(e,t,n){"use strict";var a=n(1),s=n(2),i=n(3).Table,r=n(3).Column,o=n(3).DropDown,l=n(3).Select;$(document).ready(function(){d.render(),f(a.createElement(u,null),"episodes-box"),c.render("user-contaienr"),p.render("anime-container")});var u=a.createClass({displayName:"Episode",getInitialState:function(){return{datas:new Array,page:null}},componentWillMount:function(){this.animeMap=this.getAnimeMap(),this.hostMap=this.getHostMap()},componentDidMount:function(){var e=this;Ajax.get("/api/admin/episodes",null,{success:function(t){e.setState({datas:t})}})},getHostMap:function(){var e=new Object;return Ajax.get("/api/dics/01",null,{async:!1,success:function(t){e=t}}),e},getAnimeMap:function(){var e=new Object;return Ajax.get("/api/admin/animes",null,{async:!1,success:function(t){t.map(function(t){e[t.id]=t.name})}}),e},setFliter:function(e,t){null==this.filterAttr&&(this.filterAttr=new Object),this.filterAttr[e]=t},filter:function(){var e=this;Ajax.get("/api/admin/episodes",null,{data:this.filterAttr,success:function(t){e.setState({datas:t}),this.filterAttr=null}})},renderTable:function(){return a.createElement(i,{datas:this.state.datas,titles:["名称","集号","链接","来源","更新时间","推送时间"],onSave:function(e){return Ajax.syncPost("/api/admin/episodes",e)},modify:function(e){return Ajax.syncPut("/api/admin/episodes",e)},delete:function(e){return Ajax.syncDelete("/api/admin/episodes/"+e.id)}},a.createElement(r,{name:"anime.id",type:"select",map:this.animeMap,width:"250px"}),a.createElement(r,{name:"number",width:"150px"}),a.createElement(r,{name:"url",width:"150px"}),a.createElement(r,{name:"hostId",width:"150px",type:"select",map:this.hostMap}),a.createElement(r,{name:"scratchTime",type:"datetime",width:"150px"}),a.createElement(r,{name:"pushTime",type:"datetime",width:"150px"}))},renderFilter:function(){var e=this;return a.createElement("div",{className:"ui six column doubling stackable grid container"},a.createElement("div",{className:"two column"},a.createElement(l,{name:"animeId",map:this.animeMap,onChange:function(t){return e.setFliter(t.target.name,t.target.value)}})),a.createElement("div",{className:"column"},a.createElement("button",{className:"ui small zprimary button",onClick:this.filter},"确定")))},render:function(){return a.createElement("div",null,this.renderFilter(),this.renderTable())}}),c={rendernRestButton:function(e){return a.createElement("button",{className:"ui green icon button",onClick:function(){confirm("确定重置用户:"+e.username+"的密码？")&&Ajax.put("/api/admin/users/reset/"+e.userId,null,{success:function(e){console.log(e),message("密码重置成功, 初试密码为:"+e.password)},error:function(){message("密码重置失败")}})}},a.createElement("i",{className:"refresh icon"}))},page:function(e){var t=new Object;return Ajax.get("/api/admin/users?page="+e,null,{async:!1,success:function(e){t.data=e.data,t.page={total:e.page.total,current:e.page.current}}}),t},render:function(e){f(a.createElement(i,{onPage:this.page,title:"用户管理",titles:["用户名","邮箱","状态","权限"],onRenderButtons:this.rendernRestButton,rule:USER_RULE.ADMIN,modify:function(e){return Ajax.syncPut("/api/admin/users",e)},onSave:function(e){return Ajax.syncPost("/api/admin/users",e)},delete:function(e){return Ajax.syncDelete("/api/admin/users/"+e.userId)}},a.createElement(r,{name:"username"}),a.createElement(r,{name:"email"}),a.createElement(r,{name:"status",defaultValue:"1",type:"select",map:{1:"激活",0:"未激活"}}),a.createElement(r,{name:"role",defaultValue:"0",type:"select",map:{1:"管理员",0:"普通用户"}})),e)}},p={map:function(){var e;return Ajax.get("/api/dics/02",null,{async:!1,success:function(t){e=t}}),e},page:function(e){var t=new Object;return Ajax.get("/api/admin/animes?page="+e,null,{async:!1,success:function(e){t.data=e.data,t.page=new Object,t.page={current:e.page.current,total:e.page.total}}}),t},renderButtons:function(e){return a.createElement("span",{className:"ui teal buttons"},a.createElement("div",{className:"ui floating dropdown icon button"},a.createElement("i",{className:"dropdown icon"}),a.createElement("div",{className:"menu"},a.createElement("div",{className:"item","data-href":CONTEXT+"/admin/anime/upload/"+e.id},"上传图片"),a.createElement("div",{className:"item","data-href":CONTEXT+"/admin/anime/link/"+e.id},a.createElement("i",{className:"hide icon"}),"关联"))))},render:function(e){f(a.createElement(i,{title:"番剧管理",titles:["名称\t","描述","开始连载月份","是否完结","类型"],onPage:this.page,rule:ANIME_RULE,onSave:function(e){return Ajax.syncPost("/api/admin/animes",e)},modify:function(e){return Ajax.syncPut("/api/admin/animes",e)},delete:function(e){return Ajax.syncDelete("/api/admin/animes/"+e.id)},onRenderButtons:this.renderButtons,onAfterSave:function(){initModals(),$(".ui.dropdown").dropdown()}},a.createElement(r,{name:"name",width:"150px"}),a.createElement(r,{name:"description",width:"150px",type:"textarea"}),a.createElement(r,{name:"publishMonth",type:"datetime"}),a.createElement(r,{name:"finished",type:"select",map:{false:"否",true:"是"},width:"100px"}),a.createElement(r,{name:"type",type:"select",map:this.map(),width:"200px"})),e)}},d={listOptions:function(){var e;return Ajax.get("/api/admin/dics?parentCode=-1",null,{async:!1,success:function(t){e=t}}),e},selectChange:function(e){var t=e.target.value;Ajax.get("/api/admin/dics?parentCode="+t,null,{success:function(e){h.render(e,t)}})},render:function(){f(a.createElement(o,{list:this.listOptions,onChange:this.selectChange}),"dic-select")}},h={render:function(e,t){f(a.createElement(i,{datas:e,dataKeyName:"code",titles:["编码","父编码","值","序号","使用状态"],onSave:function(e){return Ajax.syncPost("/api/admin/dics",e)},modify:function(e){return Ajax.syncPut("/api/admin/dics",e)},delete:function(e){return Ajax.syncDelete("/api/admin/dics/"+e.parentCode+"/"+e.code)},rule:m},a.createElement(r,{name:"code",width:"150px"}),a.createElement(r,{name:"parentCode",width:"150px",canModify:!1,defaultValue:t}),a.createElement(r,{name:"value",width:"150px"}),a.createElement(r,{name:"sequence",width:"150px"}),a.createElement(r,{name:"used",type:"select",map:{1:"使用",0:"暫停"}})),"dic-box")}},m={on:"blur",fields:{code:{rules:[{type:"empty"}]},value:{rules:[{type:"empty"}]},sequence:{rules:[{type:"number"}]}}},f=function(e,t){var n=document.getElementById(t);null!=n?s.render(e,n):console.debug("#"+t+"不存在")}},6:function(e,t,n){e.exports=n(0)(409)}});