webpackJsonp([2],{0:function(e,t,a){"use strict";var n=a(265).Table,s=a(265).Column,r=a(265).DropDown,i=a(265).Select;$(document).ready(function(){u.render(),h(React.createElement(o,null),"episodes-box"),l.render("user-contaienr"),c.render("anime-container")});var o=React.createClass({displayName:"Episode",getInitialState:function(){return{datas:new Array,page:null}},componentWillMount:function(){this.animeMap=this.getAnimeMap()},componentDidMount:function(){var e=this;Ajax.get("/api/admin/episodes",null,{success:function(t){e.setState({datas:t})}})},getAnimeMap:function(){var e=new Object;return Ajax.get("/api/admin/animes",null,{async:!1,success:function(t){t.map(function(t){e[t.id]=t.name})}}),e},setFliter:function(e,t){null==this.filterAttr&&(this.filterAttr=new Object),this.filterAttr[e]=t},filter:function(){var e=this;Ajax.get("/api/admin/episodes",null,{data:this.filterAttr,success:function(t){e.setState({datas:t}),this.filterAttr=null}})},renderTable:function(){return React.createElement(n,{datas:this.state.datas,titles:["名称","集号","链接","更新时间","推送时间"],onSave:function(e){return Ajax.syncPost("/api/admin/episodes",e)},modify:function(e){return Ajax.syncPut("/api/admin/episodes",e)},delete:function(e){return Ajax.syncDelete("/api/admin/episodes/"+e.id)}},React.createElement(s,{name:"anime.id",type:"select",map:this.animeMap,width:"250px"}),React.createElement(s,{name:"number",width:"150px"}),React.createElement(s,{name:"url",width:"150px"}),React.createElement(s,{name:"scratchTime",type:"datetime",width:"150px"}),React.createElement(s,{name:"pushTime",type:"datetime",width:"150px"}))},renderFilter:function(){var e=this;return React.createElement("div",{className:"ui six column doubling stackable grid container"},React.createElement("div",{className:"two column"},React.createElement(i,{name:"animeId",map:this.animeMap,onChange:function(t){return e.setFliter(t.target.name,t.target.value)}})),React.createElement("div",{className:"column"},React.createElement("button",{className:"ui small zprimary button",onClick:this.filter},"确定")))},render:function(){return React.createElement("div",null,this.renderFilter(),this.renderTable())}}),l={rendernRestButton:function(e){var t=function(){confirm("确定重置用户:"+e.username+"的密码？")&&Ajax.put("/api/admin/users/reset/"+e.userId,null,{success:function(e){console.log(e),message("密码重置成功, 初试密码为:"+e.password)},error:function(){message("密码重置失败")}})};return React.createElement("button",{className:"ui green icon button",onClick:t},React.createElement("i",{className:"refresh icon"}))},page:function(e){var t=new Object;return Ajax.get("/api/admin/users?page="+e,null,{async:!1,success:function(e){t.data=e.data,t.page={total:e.page.totalPage,current:e.page.curPage}}}),t},render:function(e){h(React.createElement(n,{onPage:this.page,title:"用户管理",titles:["用户名","邮箱","状态","权限"],onRenderButtons:this.rendernRestButton,rule:USER_RULE.ADMIN,modify:function(e){return Ajax.syncPut("/api/admin/users",e)},onSave:function(e){return Ajax.syncPost("/api/admin/users",e)},delete:function(e){return Ajax.syncDelete("/api/admin/users/"+e.userId)}},React.createElement(s,{name:"username"}),React.createElement(s,{name:"email"}),React.createElement(s,{name:"status",defaultValue:"1",type:"select",map:{1:"激活",0:"未激活"}}),React.createElement(s,{name:"role",defaultValue:"0",type:"select",map:{1:"管理员",0:"普通用户"}})),e)}},c={map:function(){var e;return Ajax.get("/api/dics/02",null,{async:!1,success:function(t){e=t}}),e},page:function(e){var t=new Object;return Ajax.get("/api/admin/animes?page="+e,null,{async:!1,success:function(e){t.data=e.data,t.page=new Object,t.page={current:e.page.curPage,total:e.page.totalPage}}}),t},renderButtons:function(e){return React.createElement("span",{className:"ui teal buttons"},React.createElement("div",{className:"ui floating dropdown icon button"},React.createElement("i",{className:"dropdown icon"}),React.createElement("div",{className:"menu"},React.createElement("div",{className:"item","data-href":CONTEXT+"/admin/anime/upload/"+e.id},"上传图片"),React.createElement("div",{className:"item","data-href":CONTEXT+"/admin/anime/link/"+e.id},React.createElement("i",{className:"hide icon"}),"关联"))))},render:function(e){h(React.createElement(n,{titles:["名称\t","描述","开始连载月份","是否完结","类型"],onPage:this.page,rule:ANIME_RULE,onSave:function(e){return Ajax.syncPost("/api/admin/animes",e)},modify:function(e){return Ajax.syncPut("/api/admin/animes",e)},delete:function(e){return Ajax.syncDelete("/api/admin/animes/"+e.id)},onRenderButtons:this.renderButtons},React.createElement(s,{name:"name",width:"150px"}),React.createElement(s,{name:"description",width:"150px",type:"textarea"}),React.createElement(s,{name:"publishMonth",type:"datetime"}),React.createElement(s,{name:"finished",type:"select",map:{false:"否",true:"是"},width:"100px"}),React.createElement(s,{name:"type",type:"select",map:this.map(),width:"200px"})),e)}},u={listOptions:function(){var e;return Ajax.get("/api/admin/dics?parentCode=-1",null,{async:!1,success:function(t){e=t}}),e},selectChange:function(e){var t=e.target.value;Ajax.get("/api/admin/dics?parentCode="+t,null,{success:function(e){p.render(e,t)}})},render:function(){h(React.createElement(r,{list:this.listOptions,onChange:this.selectChange}),"dic-select")}},p={render:function(e,t){h(React.createElement(n,{datas:e,dataKeyName:"code",titles:["编码","父编码","值","序号","使用状态"],onSave:function(e){return Ajax.syncPost("/api/admin/dics",e)},modify:function(e){return Ajax.syncPut("/api/admin/dics",e)},delete:function(e){return Ajax.syncDelete("/api/admin/dics/"+e.parentCode+"/"+e.code)},rule:d},React.createElement(s,{name:"code",width:"150px"}),React.createElement(s,{name:"parentCode",width:"150px",canModify:!1,defaultValue:t}),React.createElement(s,{name:"value",width:"150px"}),React.createElement(s,{name:"sequence",width:"150px"}),React.createElement(s,{name:"used",type:"select",map:{1:"使用",0:"暫停"}})),"dic-box")}},d={on:"blur",fields:{code:{rules:[{type:"empty"}]},value:{rules:[{type:"empty"}]},sequence:{rules:[{type:"number"}]}}},h=function(e,t){var a=document.getElementById(t);return null==a?void console.debug("#"+t+"不存在"):void ReactDOM.render(e,a)}},265:function(e,t,a){"use strict";function n(e,t){var a=new Map,n=new Map;e.map(function(e){var s=e[t];a.set(s,e),n.set(s,d(e))});var s={sync:function(e){var t=n.get(e);a.set(e,d(t))},get:function(e){return a.get(e)},set:function(e,t){a.set(e,t),n.set(e,d(t))},setCurrent:function(e,t){a.set(e,t)},array:function(){return a.values()},remove:function(e){console.debug(e),a.delete(e),n.delete(e)},values:function(e){return a.values()},map:function(){return a}};return s}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=a(261),i="origin",o="modify",l="new",c="newmodify",u=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,a="x"==e?t:3&t|8;return a.toString(16)}).toUpperCase()},p={setPropoerty:function(e,t,a){if(null==e)throw"obj is null";var n=e,s=t.split(".");console.debug("setPropoerty:",s);for(var r=0;r<s.length;r++){var i=s[r];r==s.length-1?n[i]=a:(null==n[i]&&(n[i]=new Object),n=n[i])}console.debug("setPropoerty:",e)},getProperty:function(e,t){if(null==e)throw"obj is null";for(var a=e,n=t.split("."),s=0;s<n.length;s++){var r=n[s];if(s!=n.length-1&&null==a[r])throw r+"is null";a=a[r]}return a}},d=function e(t){var a,n=t.constructor===Array?[]:{};if("object"===("undefined"==typeof t?"undefined":s(t))){if(window.JSON)a=JSON.stringify(t),n=JSON.parse(a);else for(var r in t)n[r]="object"===s(t[r])?e(t[r]):t[r];return n}},h=React.createClass({displayName:"Table",getDefaultProps:function(){return{titles:new Array,datas:new Array,onSave:function(e){return!0},modify:function(e){return!0},delete:function(e){return!0},onRenderButtons:function(e){return null},page:{current:1,total:1},displayEditButtons:!0}},getInitialState:function(){this.init();var e=this.props.datas,t=null;return e.length>0&&(t=this.initDoubleData(e)),{page:this.props.page,doubleDatas:t,hasNewRow:!1}},init:function(){this.autoKey=!this.props.hasOwnProperty("primaryKey"),this.columns=this.getColumns()},getColumns:function(){var e=new Array;return React.Children.map(this.props.children,function(t){"Column"==t.type.displayName&&e.push(t)}),e},initDoubleData:function(e){var t=this,a=e.map(function(e){return e._status=i,e._key=t.getKey(e),e});return n(a,"_key")},componentDidMount:function(){var e=this,t=function(){document.addEventListener("keydown",function(t){t.ctrlKey&&"KeyI"==t.code&&e.insertRow()})};t();var a=function(){if(null==e.state.doubleDatas){if(e.props.hasOwnProperty("onList"))return void e.handleList();e.props.hasOwnProperty("onPage")&&e.handlePage("1")}};a()},componentWillReceiveProps:function(e){this.setState({doubleDatas:this.initDoubleData(e.datas)})},getKey:function(e){return this.autoKey||e._status==l?u():e[this.props.primaryKey]},handleDelete:function(e,t){if(confirm("确认删除？")){var a=!0;if(a=this.props.delete(e),!a)return void alert("删除失败");this.state.doubleDatas.remove(e._key),this.setState({doubleDatas:this.state.doubleDatas})}},handleModify:function(e,t){var a=this.state.doubleDatas.get(e._key);a._status=o,this.state.doubleDatas.setCurrent(e._key,a),this.setState({doubleDatas:this.state.doubleDatas})},handleSave:function(e,t){var a=!0;return(a=e._status==l||e._status==c?this.props.onSave(e):this.props.modify(e))?(e._status!=l&&e._status!=c||(e._key=this.getKey(e),this.setState({hasNewRow:!1})),e._status=i,this.state.doubleDatas.set(e._key,e),void this.setState({doubleDatas:this.state.doubleDatas})):void alert("保存失败")},handleCancel:function(e,t){e._status!=l&&e._status!=c||this.setState({hasNewRow:!1}),e._status!=l&&e._status!=c&&(this.state.doubleDatas.sync(e._key),this.setState({doubleDatas:this.state.doubleDatas}))},handleList:function(){var e=this.props.onList(),t=this.initDoubleData(e);this.setState({doubleDatas:t})},handlePage:function(e){var t=this.props.onPage(e),a=t.page,n=this.initDoubleData(t.data);this.setState({doubleDatas:n,page:a})},insertRow:function(){1!=this.state.hasNewRow&&this.setState({hasNewRow:!0})},renderColumnTitles:function(){var e=this.props.titles;return e.map(function(e){return React.createElement("th",{className:"single line"},e)})},renderInsertButton:function(){return this.props.displayEditButtons?React.createElement("button",{className:"ui teal icon button",disabled:this.state.hasNewRow?"disabled":"",onClick:this.insertRow},React.createElement("i",{className:"ui plus icon"})):null},renderRow:function(e){return React.createElement(m,{data:e,key:e._key,status:e._status,onDeleteClick:this.handleDelete,onModifyClick:this.handleModify,onSaveClick:this.handleSave,onCancelClick:this.handleCancel,onRenderButtons:this.props.onRenderButtons,displayEditButtons:this.props.displayEditButtons,rule:this.props.rule,columns:this.columns})},renderRows:function(){var e=this;if(null==this.state.doubleDatas)return null;var t=new Array;return this.state.doubleDatas.map().forEach(function(a,n,s){t.push(e.renderRow(a))}),t},renderNewRow:function(){if(!this.state.hasNewRow)return null;var e=new Object;return e._status=l,e._key=this.getKey(e),this.renderRow(e)},render:function(){var e=this.renderColumnTitles(),t=this.renderInsertButton(),a=this.renderRows(),n=this.renderNewRow();return console.debug("Table render"),React.createElement("div",{ref:"container"},React.createElement("h3",null,this.props.title),React.createElement(E,{onPage:this.handlePage,current:this.state.page.current,total:this.state.page.total}),React.createElement("table",{className:"ui celled compact table"},React.createElement("thead",null,React.createElement("tr",{className:"form"},e,React.createElement("th",null,t))),React.createElement("tbody",null,n,a)))}}),m=React.createClass({displayName:"Row",getInitialState:function(){return{data:this.props.data,status:this.props.status}},componentWillReceiveProps:function(e){this.setState({data:e.data,status:e.status})},shouldComponentUpdate:function(e,t){return(e.data!=this.props.data||e.status!=this.props.status)&&(console.debug("ComponentUpdate\n","nextProps:",e,"\n","this.props:",this.props),!0)},componentDidMount:function(){if(this.needValidate=!1,this.props.hasOwnProperty("rule")&&void 0!=this.props.rule){this.needValidate=!0;var e=this.props.rule;e.onInvalid=function(e){$(this).popup("exists")?$(this).popup("change content",e):$(this).popup({content:e,on:"manual",inline:!0}),$(this).popup("show")},e.onValid=function(){$(this).popup("exists")&&$(this).popup("hide")},$(this.refs.tr).form(this.props.rule)}},deleteClick:function(){this.props.onDeleteClick(this.state.data,this.props.key)},modifyClick:function(){this.props.onModifyClick(this.state.data,this.props.key)},saveClick:function(){this.isValidate()&&this.props.onSaveClick(this.state.data,this.props.key)},cancelClick:function(){return $(document).popup("hide all"),this.state.status==l||this.state.status==c?void this.props.onCancelClick(this.props.data,this.props.key):void this.props.onCancelClick(this.props.data,this.props.key)},isValidate:function(){return!this.needValidate||($(this.refs.tr).form("validate form"),$(this.refs.tr).form("is valid"))},change:function(e,t){var a=e.target.name;null==t&&(t=e.target.value);var n=this.state.status;n==l&&(n=c),this.setState(function(e,s){var r=e.data;return p.setPropoerty(r,a,t),console.debug("change data",r),{data:r,status:n}})},renderRow:function(){var e=this.state.status,t=this.state.data,a=this;return console.debug("Row renderRow:",t),console.debug(e),this.props.columns.map(function(n){e==l&&p.setPropoerty(t,n.props.name,n.props.defaultValue);var s=p.getProperty(t,n.props.name),r={value:s,status:e,readOnly:e!=o&&e!=l&&e!=c,onChange:a.change},i=React.cloneElement(n,r);return React.createElement("td",{className:"collapsing"},React.createElement("div",{className:"field"},i))})},renderButtons:function(){var e=this.state.status,t=new Array;return this.props.displayEditButtons&&(e!=o&&e!=l&&e!=c||(t.push(React.createElement("button",{className:"ui orange icon button",onClick:this.saveClick},React.createElement("i",{className:e==l||e==c?"add circle icon":"save icon"}))),t.push(React.createElement("button",{className:"ui icon button",onClick:this.cancelClick},React.createElement("i",{className:"undo icon"})))),e!=o&&e!=l&&e!=c&&(t.push(React.createElement("button",{className:"ui blue icon button",onClick:this.modifyClick},React.createElement("i",{className:"edit icon"}))),t.push(React.createElement("button",{className:"ui red icon button",onClick:this.deleteClick},React.createElement("i",{className:"trash icon"}))))),t.push(this.props.onRenderButtons(this.state.data)),React.createElement("td",null,t)},render:function(){return console.debug("render row:",this.state.data),React.createElement("tr",{ref:"tr"},this.renderRow(),this.renderButtons())}}),f=React.createClass({displayName:"Input",getDefaultProps:function(){return{border:!1}},getInitialState:function(){return{value:this.props.value}},handleChange:function(e){null!=this.props.onChange&&this.props.onChange(e),this.setState({value:e.target.value})},handleBlur:function(e){null!=this.props.onBlur&&this.props.onBlur(e),this.setState({value:e.target.value})},componentWillReceiveProps:function(e){this.state.value!=e.value&&this.setState({value:e.value})},render:function(){var e=this.props.style,t=!this.props.readOnly||this.props.border;return t||(null==e&&(e=new Object),e.border="1px solid rgba(0, 0, 0, 0.0)"),React.createElement("input",{value:this.state.value,name:this.props.name,type:this.props.type,onChange:this.handleChange,onBlur:this.handleBlur,readOnly:this.props.readOnly&&"readOnly",style:e})}}),y=React.createClass({displayName:"Select",getDefaultProps:function(){return{value:""}},getInitialState:function(){return{value:this.props.value}},handleChange:function(e){console.debug(e),console.debug(this.props.onChange),null!=this.props.onChange&&this.props.onChange(e)},componentWillReceiveProps:function(e){this.state.value!=e.value&&this.setState({value:e.value})},componentDidMount:function(){var e=this;$(e.refs.select).dropdown({onChange:function(t,a,n){var s={target:{value:t,name:e.props.name}};e.handleChange(s)}})},componentDidUpdate:function(e,t){$(this.refs.select).dropdown("set selected",this.state.value)},renderItems:function(){var e=new Array;for(var t in this.props.map){var a=React.createElement("div",{className:"item","data-value":t},this.props.map[t]);e.push(a)}return e},getStyle:function(){var e=this.props.style;return null==e&&(e=new Object),e.minWidth="8rem",e},render:function(){var e=this.getStyle();return React.createElement("div",{ref:"select",className:"ui selection dropdown search fluid "+(this.props.readOnly&&"disabled"),style:e,name:this.props.name},React.createElement("input",{type:"hidden",name:this.props.name,value:this.state.value}),React.createElement("div",{className:"default text"}),React.createElement("i",{className:"dropdown icon"}),React.createElement("div",{className:"menu"},this.renderItems()))}}),v=React.createClass({displayName:"Column",getDefaultProps:function(){return{readOnly:!0,canModify:!0,defaultValue:""}},render:function(){var e=this.props.readOnly,t=(this.props.status,this.props.value),a=this.props.width;return this.props.canModify||(e=!0),"select"==this.props.type?React.createElement(y,{value:t,name:this.props.name,map:this.props.map,style:{maxWidth:a},readOnly:e,onChange:this.props.onChange}):"datetime"==this.props.type?React.createElement(R,{value:t,readOnly:e,style:{maxWidth:a},name:this.props.name,onChange:this.props.onChange}):"textarea"==this.props.type?React.createElement(g,{value:t,readOnly:e,style:{maxWidth:a},name:this.props.name,onChange:this.props.onChange}):React.createElement("div",{className:"ui small input",style:{maxWidth:a}},React.createElement(f,{value:t,name:this.props.name,type:this.props.type,readOnly:e,onBlur:this.props.onChange}))}}),g=React.createClass({displayName:"TextArea",getInitialState:function(){return{value:this.props.value}},componentWillReceiveProps:function(e){this.setState({value:e.value})},handleClick:function(){this.props.readOnly||$(this.refs.modal).modal("show")},handleChange:function(e){this.props.onChange(e),this.setState({value:e.target.value})},renderInput:function(){return React.createElement("div",{className:"ui small icon input",style:this.props.style,onClick:this.handleClick},React.createElement(f,{value:this.state.value,name:this.props.name,readOnly:!0,border:!this.props.readOnly}),!this.props.readOnly&&React.createElement("i",{className:"edit outline icon"}))},renderModal:function(){return React.createElement("div",{className:"ui modal",ref:"modal"},React.createElement("div",{className:"content"},React.createElement("div",{className:"ui form"},React.createElement("textarea",{name:this.props.name,value:this.state.value,onChange:this.handleChange}))))},render:function(){return React.createElement("div",null,this.renderInput(),this.renderModal())}}),R=React.createClass({displayName:"Datetime",handleChange:function(e){var t=r(e.target.value).format("x");this.props.onChange(e,t)},render:function(){console.debug(this.props.value);var e=r(parseInt(this.props.value)).format("YYYY-MM-DDTHH:mm");return React.createElement("div",{className:"ui small input",style:this.props.style},React.createElement(f,{type:"datetime-local",value:e,name:this.props.name,readOnly:this.props.readOnly,onBlur:this.handleChange}))}}),E=React.createClass({displayName:"Page",getDefaultProps:function(){return{onPage:function(e){return!0},current:1,total:1}},getInitialState:function(){return{current:this.props.current,total:this.props.total}},componentWillReceiveProps:function(e){e.total!=this.state.total&&this.setState({total:e.total}),this.setState({current:e.current})},renderItems:function(){for(var e=this,t=new Array,a=function(a){a==e.state.current?t.push(React.createElement("a",{className:"active item"},a)):t.push(React.createElement("a",{className:"item",onClick:function(){e.onClick(a)}},a))},n=1;n<=this.state.total;n++)a(n);return t},onClick:function(e){e<1||e>this.state.total||this.props.onPage(e)&&this.setState({current:e})},render:function(){var e=this;return 1==this.state.current&&1==this.state.total?null:React.createElement("div",{className:"ui right floated pagination mini menu",style:{margin:"5px 0"}},React.createElement("a",{className:"icon item",onClick:function(){e.onClick(e.state.current-1)}},React.createElement("i",{className:"left chevron icon"})),this.renderItems(),React.createElement("a",{className:"icon item",onClick:function(){e.onClick(e.state.current+1)}},React.createElement("i",{className:"right chevron icon"})))}}),C=React.createClass({displayName:"DropDown",componentWillMount:function(){var e=this.props.list(),t=e.map(function(e,t){return React.createElement("option",{value:e.code},e.code+"-"+e.value)});this.setState({options:t})},componentDidMount:function(){var e=$(this.refs.select);e.dropdown();var t=e.find("option"),a=null;t.length>0&&(a=t.get(0).value),null!=a&&this.handleChange({target:{value:a}})},handleChange:function(e){console.debug(e),this.props.onChange(e)},render:function(){var e=this.state.options;return React.createElement("select",{ref:"select",className:"ui search dropdown",onChange:this.handleChange,onLoad:this.handleChange},e)}});e.exports.Table=h,e.exports.Column=v,e.exports.DropDown=C,e.exports.Select=y,e.exports.Page=E}});